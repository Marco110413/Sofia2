#!/bin/bash

# Archivo de configuraciÃ³n
CONFIG_FILE="$HOME/gestor_de_tokens/config.txt"
HISTORIAL_FILE="$HOME/gestor_de_tokens/historial.txt"

# FunciÃ³n para cargar configuraciÃ³n desde el Gestor de Proyectos
cargar_configuracion() {
    if [ -f "$CONFIG_FILE" ]; then
        source "$CONFIG_FILE"
    else
        echo "âš  No se encontrÃ³ la configuraciÃ³n. Configura tu cuenta en el Gestor de Proyectos."
        exit 1
    fi
}

# FunciÃ³n para mostrar el menÃº principal
mostrar_menu() {
    clear
    echo "=============================="
    echo "  ğŸŸï¸ Gestor de Tokens"
    echo "=============================="
    echo "ğŸ“Œ Usuario: $USUARIO"
    echo "1ï¸âƒ£ Registrarse"
    echo "2ï¸âƒ£ Iniciar sesiÃ³n"
    echo "3ï¸âƒ£ Ver tokens"
    echo "4ï¸âƒ£ Convertir tokens a USDT"
    echo "5ï¸âƒ£ Historial de transacciones"
    echo "6ï¸âƒ£ Salir"
    echo "=============================="
    echo "Seleccione una opciÃ³n:"
}

# FunciÃ³n para registrar un usuario
registrarse() {
    read -p "ğŸ“§ Ingrese su correo: " USUARIO
    echo "USUARIO=$USUARIO" > "$CONFIG_FILE"
    echo "âœ” Registro exitoso. Ahora puede iniciar sesiÃ³n."
}

# FunciÃ³n para iniciar sesiÃ³n
iniciar_sesion() {
    if [ -f "$CONFIG_FILE" ]; then
        source "$CONFIG_FILE"
        echo "ğŸ”“ SesiÃ³n iniciada como $USUARIO"
    else
        echo "âš  No se encontrÃ³ un usuario registrado. RegÃ­strese primero."
    fi
}

# FunciÃ³n para ver tokens (contador en tiempo real)
ver_tokens() {
    clear
    echo "=============================="
    echo "  Contador de Tokens"
    echo "=============================="
    echo "ğŸ“Œ Usuario: $USUARIO"
    TOKENS=100  # SimulaciÃ³n de tokens iniciales

    while true; do
        echo -ne "â³ Tokens actuales: $TOKENS \r"
        TOKENS=$((TOKENS + 1))  # Incremento automÃ¡tico
        sleep 1

        # Permitir salir escribiendo "volver"
        read -t 0.1 entrada
        if [[ $entrada == "volver" ]]; then
            break
        fi
    done
}

# FunciÃ³n para convertir tokens a USDT
convertir_tokens() {
    clear
    echo "=============================="
    echo "  ConversiÃ³n de Tokens a USDT"
    echo "=============================="
    echo "ğŸ“Œ Usuario: $USUARIO"

    TOKENS=500  # SimulaciÃ³n de tokens disponibles
    TASA_USDT=0.018
    USDT=$(echo "$TOKENS * $TASA_USDT" | bc)

    echo "ğŸ’° Tokens actuales: $TOKENS"
    echo "ğŸ”„ Tasa actual: 1 Token = $TASA_USDT USDT"
    echo "ğŸ’µ USDT recibidos: $USDT"
    read -p "â“ Â¿Deseas continuar? (SÃ­ / No): " CONFIRMAR

    if [[ "$CONFIRMAR" =~ ^[Ss]Ã­$ ]]; then
        echo "$(date) | ğŸ”„ $TOKENS Tokens â†’ ğŸ’µ $USDT USDT" >> "$HISTORIAL_FILE"
        echo "âœ” ConversiÃ³n exitosa."
    else
        echo "âŒ OperaciÃ³n cancelada."
    fi
}

# FunciÃ³n para mostrar el historial de transacciones
historial_transacciones() {
    clear
    echo "=============================="
    echo "  Historial de Transacciones"
    echo "=============================="
    echo "ğŸ“Œ Usuario: $USUARIO"

    if [ -f "$HISTORIAL_FILE" ]; then
        cat "$HISTORIAL_FILE"
    else
        echo "ğŸ“‚ No hay transacciones registradas."
    fi
}

# Cargar configuraciÃ³n y mostrar menÃº
cargar_configuracion

while true; do
    mostrar_menu
    read -p "> " OPCION

    case $OPCION in
        1) registrarse ;;
        2) iniciar_sesion ;;
        3) ver_tokens ;;
        4) convertir_tokens ;;
        5) historial_transacciones ;;
        6) echo "ğŸ‘‹ Saliendo..."; exit ;;
        *) echo "âŒ OpciÃ³n no vÃ¡lida." ;;
    esac

    read -p "Presione Enter para continuar..."
done
